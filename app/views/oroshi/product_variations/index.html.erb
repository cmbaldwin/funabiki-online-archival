<%= turbo_frame_tag 'product_variations' do %>

  <div class="d-flex flex-column align-items-center flex-lg-row align-items-lg-start justify-content-around gap-2">
    <div class="card" style="min-width: 18rem; width: 18rem;">
      <div class="card-body overflow-auto" style="max-height: 75vh;">
        <div class="card-title d-flex justify-content-between align-items-center align-middle">
          <h5 class="mb-0"><%= "#{@product.name}の" if @product %>商品変種</h5>
          <%= link_to icon('arrow-clockwise'), oroshi_product_product_variations_path(@product), class: 'btn btn-sm btn-light', data: { turbo_frame: 'product_variations' } %>
        </div>
        <% if @product_variations %>
          <div class="list-group mb-3">
            <% @product_variations.each do |product_variation| %>
              <% link_class = 'list-group-item list-group-item-action d-flex justify-content-between align-items-start' %>
              <% link_class += ' active' if @product_variations.first == product_variation %>
              <% link_class += ' list-group-item-light opacity-50' unless product_variation.active %>
              <%= link_to load_oroshi_product_variation_path(product_variation),
                          class: link_class,
                          data: {
                            turbo_frame: 'product_variation',
                            action: 'oroshi--dashboard#toggleActiveListItem:passive'
                          } do %>
                  <div class="ms-2 me-auto overflow-hidden">
                    <div class="fw-bold"><%= product_variation.to_s %> (<%= product_variation.handle %>)</div>
                  </div>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <div class="alert alert-warning" role="alert">
            商品変種が登録されていません。まずは商品変種を登録してください。
          </div>
        <% end %>
        <h6 class="card-subtitle mb-2 d-flex justify-content-between align-items-center align-middle">
          <%= content_tag :div, class: 'form-check form-switch d-flex justify-content-between align-items-center align-middle' do %>
            <%= content_tag :input, 
                            nil, 
                            class: 'form-check-input me-2', 
                            type: 'checkbox', 
                            id: 'activeToggle', 
                            data: { 
                              action: 'change->oroshi--dashboard#toggleShowInactive',
                              target: 'products'
                            }, 
                            checked: @show_inactive %>
            <%= label_tag 'activeToggle', '全て表示', class: 'form-check-label' %>
          <% end %>
          <%= link_to '追加',
                      new_oroshi_product_path,
                      class: 'btn btn-sm btn-success',
                      data: {
                        turbo_frame: 'oroshi_modal_content',
                        action: 'oroshi--dashboard#showModal:passive'
                      } %>
        </h6>
      </div>
    </div>

    <% product_variation_path = @product_variations.any? ? load_oroshi_product_variation_path(@product_variations.first) : load_oroshi_product_variations_path %>
    <%= turbo_frame_tag 'product_variation',
                        src: product_variation_path,
                        loading: 'lazy',
                        class: 'card flex-fill' do %>
      <div class="row m-2">
        <div class="col-12 text-center">
          <%= render partial: 'oroshi/shared/spinner' %>
        </div>
      </div>
    <% end %>

  </div>
<% end %>